<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alterga - Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <div class="logo-header">
                <img src="logo.png" alt="Alterga Logo">
                <h2>Alterga Transport</h2>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" data-view="vehicles">Pojazdy</button>
                <button class="nav-tab" data-view="trips">Rejestr Podr√≥≈ºy</button>
                <button class="nav-tab" data-view="assignments">Przypisania Pojazd√≥w</button>
                 <button class="nav-tab" data-view="transfers">Transferencias</button>
            </nav>
            <div class="user-info">
                <span id="userEmail"></span>
                <button id="logoutBtn" class="btn-logout">Wyloguj siƒô</button>
            </div>
        </header>
        
        <main>
            <!-- Vista de Veh√≠culos -->
            <div id="vehiclesView" class="view active">
                <div class="view-header">
                    <h1>ZarzƒÖdzanie FlotƒÖ</h1>
                    <button id="addVehicleBtn" class="btn-primary">+ Dodaj Pojazd</button>
                </div>
                
                <div id="vehiclesGrid" class="vehicles-grid">
                    <!-- Veh√≠culos se cargar√°n din√°micamente -->
                </div>
            </div>
            
            <!-- Vista de Detalles de Veh√≠culo -->
            <div id="vehicleDetailView" class="view">
                <div class="view-header">
                    <div>
                        <button id="backToVehiclesBtn" class="btn-secondary" style="margin-bottom: 10px;">‚Üê Powr√≥t do Pojazd√≥w</button>
                        <h1 id="vehicleDetailTitle">Szczeg√≥≈Çy Pojazdu</h1>
                        </div>
                        <button id="exportVehiclePdfBtn" class="btn-primary">Eksportuj PDF</button>
                </div>
                
                <div id="vehicleDetailTrips" class="vehicle-detail-trips">
                <!-- Viajes agrupados por conductor -->
                    <div class="table-container">
                        <!-- Las tablas se generan din√°micamente aqu√≠ -->
                    </div>
                </div>
            </div>
            
            <!-- Vista de Registros -->
            <div id="tripsView" class="view">
                <div class="view-header">
                    <h1>Rejestr Podr√≥≈ºy</h1>
                    <div class="header-actions">
                    <button id="generateTestDataBtn" class="btn-secondary">Generuj Dane Testowe</button>
                    <select id="vehicleFilter" class="filter-select">
                    <option value="">Wszystkie pojazdy</option>
                    </select>
                    <button id="viewToggleBtn" class="btn-secondary">
                    <span id="viewToggleIcon">üìä</span> Widok Tabeli
                    </button>
                    <button id="exportPdfBtn" class="btn-primary">Eksportuj PDF</button>
                    </div>
                </div>
                
                <!-- Vista de Tarjetas (Timeline) -->
                <div id="tripsCardsView" class="trips-cards-container">
                    <!-- Tarjetas se cargar√°n din√°micamente -->
                </div>
                
                <!-- Vista de Tabla -->
                <div id="tripsTableView" class="table-container" style="display: none;">
                    <table id="tripsTable" class="trips-table">
                        <thead>
                        <tr>
                        <th><input type="checkbox" id="selectAll"></th>
                        <th>Data</th>
                        <th>Kierowca</th>
                        <th>Godz. Rozpoczƒôcia</th>
                        <th>Godz. Zako≈Ñczenia</th>
                        <th>Km Rozpoczƒôcia</th>
                        <th>Km Zako≈Ñczenia</th>
                        <th>Km Razem</th>
                        <th class="desktop-only">PoczƒÖtek</th>
                        <th class="desktop-only">Cel</th>
                        <th>Paliwo PoczƒÖtkowe</th>
                        <th>Paliwo Zu≈ºyte</th>
                        <th class="desktop-only">Tankowanie</th>
                        <th>Zu≈ºycie</th>
                        <th class="desktop-only">Olej</th>
                        <th class="desktop-only">P≈Çyn czyszczƒÖcy</th>
                        <th class="desktop-only account-col">Nr Konta</th>
                        <th class="mobile-expand">+</th>
                        </tr>
                        </thead>
                        <tbody id="tripsTableBody">
                            <!-- Registros se cargar√°n din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>

                    <!-- Vista de Asignaciones -->
            <div id="assignmentsView" class="view">
                <div class="view-header">
                    <h1>Przypisania Pojazd√≥w</h1>
                    <button id="newAssignmentBtn" class="btn-primary">+ Nowe Przypisanie</button>
                </div>

                <div class="assignments-container">
                    <div class="table-container">
                        <table class="trips-table assignments-table">
                            <thead>
                                <tr>
                                    <th>Pojazd</th>
                                    <th>Kierowca</th>
                                    <th>Data Przypisania</th>
                                    <th>Status</th>
                                    <th>Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="assignmentsTableBody">
                                <!-- Asignaciones se cargar√°n din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                    </div>
                    </div>

             <!-- Vista de Transferencias -->
             <div id="transfersView" class="view">
                 <div class="view-header">
                     <h1>Transferencias de Veh√≠culos</h1>
                     <button id="newTransferBtn" class="btn-primary">+ Nueva Transferencia</button>
                 </div>

                 <div class="transfers-container">
                     <div class="table-container">
                         <table class="trips-table transfers-table">
                             <thead>
                                 <tr>
                                     <th>Veh√≠culo</th>
                                     <th>De Usuario</th>
                                     <th>A Usuario</th>
                                     <th>Fecha</th>
                                     <th>Estado</th>
                                     <th>Acciones</th>
                                 </tr>
                             </thead>
                             <tbody id="transfersTableBody">
                                 <!-- Transfers se cargar√°n din√°micamente -->
                             </tbody>
                         </table>
                     </div>
                 </div>
             </div>
         </main>
    </div>
    
    <!-- Modal Agregar/Editar Veh√≠culo -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Dodaj Pojazd</h2>
                <span class="close">&times;</span>
            </div>
            <form id="vehicleForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="registration">Numer rejestracyjny *</label>
                        <input type="text" id="registration" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="model">Model *</label>
                        <input type="text" id="model" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="brand">Marka *</label>
                        <input type="text" id="brand" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="year">Rok</label>
                        <input type="number" id="year" min="1900" max="2100">
                    </div>
                    
                    <div class="form-group">
                        <label for="currentKm">Aktualny przebieg *</label>
                        <input type="number" id="currentKm" required min="0">
                    </div>
                    
                    <div class="form-group">
                    <label for="currentFuel">Aktualne paliwo (L) *</label>
                    <input type="number" id="currentFuel" min="0" step="0.1">
                    </div>
                    
                    <div class="form-group">
                    <label for="fuelCapacity">Pojemno≈õƒá zbiornika (L)</label>
                    <input type="number" id="fuelCapacity" min="0" step="0.1">
                    </div>

                    <div class="form-group full-width">
                    <label>Typy paliwa *</label>
                    <div class="fuel-types-grid">
                    <label class="checkbox-label">
                    <input type="checkbox" id="fuelGasolina" value="Gasolina">
                    <span>Paliwo</span>
                    </label>
                    <label class="checkbox-label">
                    <input type="checkbox" id="fuelDiesel" value="Diesel">
                    <span>Diesel</span>
                    </label>
                    <label class="checkbox-label">
                    <input type="checkbox" id="fuelGas" value="Gas">
                    <span>Gas</span>
                    </label>
                    </div>
                    <small style="color: #666; font-size: 12px;">Selecciona m√°ximo 2 tipos (Gasolina + Gas, o Diesel + Gas)</small>
                    </div>

                     <!-- Dual Fuel Details -->
                     <div id="dualFuelDetails" class="form-group full-width" style="display: none;">
                         <h4>Detalles de Tanques Duales</h4>
                         <div class="dual-fuel-grid">
                             <div class="fuel-tank-section">
                                 <h5 id="tank1Label">Tanque 1</h5>
                                 <div class="form-group">
                                     <label for="fuelCapacity1">Capacidad (L)</label>
                                     <input type="number" id="fuelCapacity1" min="0" step="0.1">
                                 </div>
                                 <div class="form-group">
                                     <label for="currentFuel1">Litros Actuales (L)</label>
                                     <input type="number" id="currentFuel1" min="0" step="0.1">
                                 </div>
                             </div>
                             <div class="fuel-tank-section">
                                 <h5 id="tank2Label">Tanque 2</h5>
                                 <div class="form-group">
                                     <label for="fuelCapacity2">Capacidad (L)</label>
                                     <input type="number" id="fuelCapacity2" min="0" step="0.1">
                                 </div>
                                 <div class="form-group">
                                     <label for="currentFuel2">Litros Actuales (L)</label>
                                     <input type="number" id="currentFuel2" min="0" step="0.1">
                                 </div>
                             </div>
                         </div>
                     </div>
                    
                    <div class="form-group">
                        <label for="tireType">Typ opon</label>
                        <select id="tireType">
                        <option value="summer">Lato</option>
                        <option value="winter">Zima</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="lastServiceKm">Ostatni serwis (Km)</label>
                        <input type="number" id="lastServiceKm" min="0" placeholder="Km ostatniej wymiany oleju">
                    </div>
                    
                    <div class="form-group">
                    <label for="fuelNorm">Zu≈ºycie na mot Norma</label>
                    <input type="number" id="fuelNorm" min="0" step="0.1" placeholder="Np: 8.5">
                    </div>

                     <div class="form-group">
                         <label for="vehicleNumber">Nr</label>
                         <input type="text" id="vehicleNumber" maxlength="50" placeholder="1234567890">
                     </div>

                     <div class="form-group">
                         <label for="dateFrom">Data od</label>
                         <input type="date" id="dateFrom">
                     </div>

                     <div class="form-group">
                         <label for="dateTo">Data do</label>
                         <input type="date" id="dateTo">
                     </div>
                    
                    <div class="form-group">
                        <label for="status">Stan pojazdu</label>
                        <select id="status">
                        <option value="available">Dostƒôpny</option>
                        <option value="occupied">Zajƒôty</option>
                        <option value="broken">Uszkodzony</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="driverNameGroup" style="display: none;">
                        <label for="currentDriverName">Aktualny kierowca</label>
                        <input type="text" id="currentDriverName" placeholder="Imiƒô kierowcy">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="vehicleImage">Obraz pojazdu</label>
                        <input type="file" id="vehicleImage" accept="image/*">
                        <div id="imagePreview" class="image-preview"></div>
                        <small style="color: #666; font-size: 12px;">Opcjonalne - obrazy sƒÖ przechowywane prywatnie w Firebase Storage</small>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelBtn">Anuluj</button>
                    <button type="submit" class="btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
        </div>

        <!-- Modal Nueva Asignaci√≥n -->
        <div id="assignmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="assignmentModalTitle">Nowe Przypisanie</h2>
                <span class="close" id="assignmentModalClose">&times;</span>
            </div>
            <form id="assignmentForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="assignmentVehicle">Pojazd *</label>
                        <select id="assignmentVehicle" required>
                            <option value="">Wybierz pojazd</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="assignmentDriver">Kierowca *</label>
                        <select id="assignmentDriver" required>
                            <option value="">Wybierz kierowcƒô</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="assignmentPin">PIN (opcjonalny)</label>
                        <input type="text" id="assignmentPin" placeholder="1234" maxlength="6">
                    </div>

                    <div class="form-group">
                        <label for="assignmentNotes">Notatki</label>
                        <textarea id="assignmentNotes" rows="3" placeholder="Dodatkowe informacje"></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelAssignmentBtn">Anuluj</button>
                    <button type="submit" class="btn-primary">Przypisz</button>
                </div>
            </form>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
